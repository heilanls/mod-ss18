\documentclass{article}

\input{usepackage.tex}

% new commands for 3.2
\newcommand{\tick}{$\sqrt{}$}
\newcommand{\cross}{$\bigotimes$}

% changing the typeface to sth that looks better with SQL queries
\usepackage{lmodern}

\begin{document}
	%%% Vorgegebenes Deckblatt %%%
	\includepdf{deckblatt.pdf}
	
	%%% format and header %%%
	\input{formatAndHeader.tex}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%%%%% actual content %%%%%%%
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
	% Aufgabe 3.1 %	
	\section*{Aufgabe 3.1}
	% always using .\\ to let the query begin on a new line
		\paragraph*{a}.\\
			\textbf{SELECT} *\\
			\textbf{FROM} abteilung\\
			\textbf{WHERE} ORT $=$ 'Dresden'
			\textbf{ORDER BY} ABTEILUNGSNR \textbf{DESC}
			
		\paragraph*{b}.\\
			\textbf{SELECT DISTINCT} angestellter.PERSONALNR,angestellter.WOHNORT,projekt.PROJEKTORT,abteilung.ORT\\
			\textbf{FROM} angestellter,projekt,projektmitarbeit,abteilung\\
			\textbf{WHERE} (angestellter.PERSONALNR = projektmitarbeit.PERSONALNR) \textbf{AND} (projekt.PROJEKTORT = angestellter.WOHNORT)\\ \textbf{AND} (angestellter.ABTEILUNGSNR = abteilung.ABTEILUNGSNR)
			
		\paragraph*{c}.\\
			\textbf{SELECT} ORT, \textbf{COUNT(*) as} Anzahl\\
			\textbf{FROM} abteilung\\
			\textbf{GROUP BY} ORT\\
			\textbf{HAVING COUNT(*)} > 1
			
		\paragraph*{d}.\\
			\textbf{SELECT} abteilung.ABTEILUNGSNR, \textbf{MAX}(angestellter.GEHALT) \textbf{as} Gehaltsmaximum\\
			\textbf{FROM} abteilung, angestellter\\
			\textbf{WHERE} abteilung.ABTEILUNGSNR $ = $ angestellter.ABTEILUNGSNR\\
			\textbf{GROUP BY} abteilung.ABTEILUNGSNR\\
			\textbf{HAVING} COUNT(angestellter.ABTEILUNGSNR) > 10
			
		
		% TODO YBL: e),f),g),h)
		\paragraph*{e}.\\
			\textbf{SELECT} angestellter.name, angestellter.vorname, gehalt \textbf{FROM}\\
			(\\
			
			\textbf{SELECT} manager \textbf{AS} m, MAX(gehalt) \textbf{AS} rich\\
			
			\textbf{FROM} angestellter\\
			
			\textbf{GROUP BY} manager\\
			
			)\\
			\textbf{INNER JOIN} angestellter ON angestellter.personalnr = m\\
			\textbf{WHERE} gehalt > rich
			
			\pagebreak
		
		\paragraph*{f}.\\
			\textbf{SELECT COUNT} (onlyindresden) \textbf{AS} MitarbeiterDieNurAnProjektenInDresdenArbeiten\\ \textbf{FROM} (\\
			\textbf{SELECT} indresden \textbf{AS} onlyindresden\\ \textbf{FROM} (\\
			\textbf{SELECT} PersonalNr \textbf{AS} indresden\\ \textbf{FROM} Projektmitarbeit, (\\
			\textbf{SELECT} ProjektNr \textbf{AS} Nr \textbf{FROM} Projekt \\
			\textbf{WHERE} Projektort \textbf{IN} 'Dresden'
			)\\
			\textbf{WHERE} ProjektNr \textbf{IN} Nr \textbf{ORDER BY} PersonalNr
			)\\
			\textbf{WHERE} indresden \textbf{NOT IN} (\\
			\textbf{SELECT} PersonalNr \textbf{AS} nichtindresden\\ \textbf{FROM} Projektmitarbeit, (\\
			\textbf{SELECT} ProjektNr \textbf{AS} NoNr\\ 
			\textbf{FROM} Projekt\\ 
			\textbf{WHERE} Projektort \textbf{NOT IN} 'Dresden'
			)\\
			\textbf{WHERE} ProjektNr \textbf{IN} NoNr\\ \textbf{ORDER BY} PersonalNr)
			)	
		
		\paragraph*{g}.\\
			\textbf{SELECT DISTINCT} Ort\\ \textbf{FROM} (\\\textbf{SELECT} Wohnort \textbf{AS} Ort\\ \textbf{FROM} Angestellter) \\
			\textbf{UNION} \\
			\textbf{SELECT} Ort\\ \textbf{FROM} Abteilung\\
			\textbf{UNION}\\
			\textbf{SELECT} Ort\\ \textbf{FROM} (\\ \textbf{SELECT} Projektort AS Ort\\ \textbf{FROM} Projekt)\\
				
		\paragraph*{h}.\\
			
						
			
		
		% TODO TOGETHER: i) & j) erläutern warum nicht das korrekte Ergebnis auusgegeben wird
		\paragraph*{i}angestellter.abteilungsnr geht nicht weil man nach einem \textbf{NATURAL JOIN} nicht wissen kann von welcher Tabelle die Abteilungsnummer kommt?\\
			\textbf{SELECT} personalnr, abteilung.abteilungsnr, abteilung.name\\
			\textbf{FROM} abteilung\\ 
			\textbf{INNER JOIN} angestellter \textbf{ON} angestellter.abteilungsnr = abteilung.abteilungsnr
			
		\paragraph*{j.}Hier wurde der COUNT falsch verwendet und anstatt $Wohnort$ f"alschlicherweise $Ort$ benutzt.\\
			\textbf{SELECT} Wohnort\\
			\textbf{FROM} angestellter\\
			\textbf{WHERE} Wohnort \textbf{IN} ('Hamburg','Muenchen','Stuttgart')\\
			\textbf{GROUP BY} Wohnort\\
			\textbf{HAVING COUNT}(Wohnort) $>$ 1\\
			
			
	\pagebreak
	% Aufgabe 3.2 %
	\section*{Aufgabe 3.2}
		\paragraph*{a.}
		
		\paragraph*{b.}.\\
			% ich glaub das ist richtig:
			% \textbf{DELETE}\\
			% \textbf{FROM} abteilung
			% \textbf{WHERE} ORT = Köln
			
		\paragraph*{c.}
		
		
		\paragraph*{d.}.\\
			\textbf{CREATE VIEW}  projects\_munich \textbf{AS}\\
			\textbf{SELECT} projekt.PROJEKTNR,projekt.PROJEKTNAME,projekt.PROJEKTORT\\
			\textbf{FROM} angestellter, projekt, projektmitarbeit\\
			\textbf{WHERE} angestellter.PERSONALNR = projektmitarbeit.PERSONALNR \textbf{AND} projektmitarbeit.PROJEKTNR = projekt.PROJEKTNR \textbf{AND} projekt.PROJEKTORT = 'Muenchen'\\
			\textbf{GROUP BY} projekt.PROJEKTORT, projekt.PROJEKTNAME,projekt.PROJEKTNR\\
			\textbf{HAVING} COUNT(*) >= 5
			
		\paragraph*{e.}.\\
			\textbf{DELETE FROM} projekt
		
		\pagebreak
			
		\paragraph*{f.}.\\
			\textbf{CREATE TABLE} angestellter(\\
			
				PERSONALNR integer \textbf{NOT NULL PRIMARY KEY},\\
				
				NAME varchar(25),\\
				
				VORNAME varchar(25),\\
				
				BERUF varchar(25),\\
				
				GEHALT decimal,\\
				
				ABTEILUNGSNR integer \textbf{FOREIGN KEY REFERENCES} abteilung(ABTEILUNGSNR) \textbf{NOTNULL},\\
				
				MANAGER integer \textbf{FOREIGN KEY REFERENCES} angestellter(PERSONALNR),\\
				
				GEBURTSTAG date,\\
				
				WOHNORT varchar(25));
			
			
\end{document}