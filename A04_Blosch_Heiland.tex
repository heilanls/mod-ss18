\documentclass{article}

\input{usepackage.tex}

\begin{document}
	%%% Vorgegebenes Deckblatt %%%
	\includepdf{deckblatt.pdf}
	
	%%% format and header %%%
	\input{formatAndHeader.tex}
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	%%%%%%% actual content %%%%%%%
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	\section*{Aufgabe 4.1}
		% relationale Algebra: Datum aller Darlehen über >5.000€
		\paragraph*{a.}
			$\pi_{Datum}(\rho_{(d\_kredithoehe>5.000)} darlehen)$
			
		% rel. Algebra: IDs aller Konten die ein Darl. über >20.000€ haben und KOntaktperson in Berlin
		\paragraph*{b.}
			% alle Mitarbeiter aus Berlin
			$Q_1 \leftarrow \rho_{a\_ort = 'Berlin'}(mitarbeiter \underset{m\_adresse = a\_id}{\bowtie} adresse)$ \\[1.2em]
			
			% alle Konten mit Kontaktperson in Berlin
			$Q_2 \leftarrow \pi_{b\_id}(bankkonto \underset{b\_kontaktperson = m\_id}{\bowtie} Q_1)$
			\\[1.2em]
			
			% alle Darlehen mit kontaktperson in Berlin und > 20.000
			$\pi_{d\_bankkonto}(\rho_{d\_kredithoehe > 20.000}(darlehen \underset{d\_bankkonto = b\_id}{\bowtie} Q_2))$\\
			
			
		% SQL-query: Name,Alter,Anzahl Kredite,PLZ aller Kunden absteigend nach Alter sortiert
		\paragraph*{c}.\\
			%%%
			\textbf{SELECT} k\_name, k\_alter, k\_kredite, adresse.a\_plz as plz\\
			\textbf{FROM} kunde, adresse\\
			\textbf{WHERE} kunde.k\_adresse $ = $ adresse.a\_id\\
			\textbf{ORDER BY} k\_alter \textbf{DESCENDING}
			
		% Geben Sie eine Anfrage in SQL-Notation an, die für jeden Mitarbeiter den Namen und die Anzahl der Bankkonten, bei denen er als Kontaktperson fungiert und deren Guthaben niedriger als 5000 ist, ausgibt. Es sollen nur Mitarbeiter ausgegeben werden, die insgesamt bei weniger als 50 Bankkonten Kontaktpersonen sind.
		\paragraph*{d}.\\
			\textbf{SELECT} m\_name, COUNT(*) \textbf{AS} anzahl\_konten\\
			\textbf{FROM} mitarbeiter, bankkonto\\
			\textbf{WHERE} mitarbeiter.m\_id $ = $ bankkonto.b\_kontaktperson\\
			\textbf{GROUP BY} bankkonto.b\_kontaktperson\\
			\textbf{HAVING COUNT}(*) $<$ 50
		
		% SQL-query: Name, Alter aller Kunden, die mind. 1 Darl. haben, dessen Höhe > Durchschnittskredithöhe ist (ohne Duplikate -> DISTINCT)
		\paragraph*{e}.\\
			\textbf{SELECT} k\_name, k\_alter\\
			\textbf{FROM} kunde, darlehen\\
			\textbf{WHERE} k\_id $ = $ d\_kunde\\
			\textbf{AND} d\_kredithoehe > (\textbf{SELECT AVG}(d\_kredithoehe) \textbf{FROM} darlehen)
		
		% SQL: immer wenn in einer Adresse "Stuttgart" vorkommt, soll der Ort in "Stuttgart" geändert werden. z.B.: Stuttgart-Vaihingen -> Stuttgart, PenisStuttgart -> Stuttgart
		\paragraph*{f}.\\
			\textbf{UPDATE} adresse\\
			\textbf{SET} ort $ = $ 'Stuttgart'\\
			\textbf{WHERE} ort \textbf{LIKE} '\%Stuttgart\%'\\
	
		\pagebreak
	
	\section*{Aufgabe 4.2}
		% Gegeben ist die Datenbank aus Aufgabe 1, Einträge: s. Blatt. Zusätzlich wird folgender Trigger erstellt:
		% CREATE TRIGGER T1
			% AFTER INSERT ON darlehen
			% REFERENCING NEW ROW AS r
			% FOR EACH ROW
			% UPDATE bankkonto
			% SET b_guthaben=b_guthaben + r.d_kredithoehe
			% WHERE b_inhaber=r.d_kunde;
		% Geben Sie an, ob die Anweisung korrekt/nicht korrekt ist (mit Erklärung!)
		\paragraph*{a.}nicht zul"assig\\
		Wegen Constraint/Fremdschl"ussel \textbf{k\_adresse\_fk} (die Tabelle $ adresse $ hat keine Zeile mit $a\_id = 103$)
		
		\paragraph*{b.}nicht zul"assig\\
		Wegen Constraint/Prim"arschl"ussel \textbf{k\_kunde\_pk} (201 ist keine g"ultige ID mehr)
		
		\paragraph*{c.}zul"assig\\
		Tupel (101,Nobelstraße,Stuttgart,70569) wird aus Tabelle $ adresse $ entfernt.\\
		In der Tabelle $ mitarbeiter $ werden aufgrund des Fremdschl"ussels \textbf{m\_adresse\_fk} alle Eintr"age in der Spalte $ m\_adresse $, die 101 sind, zu \textbf{NULL} ge"andert.
		
		\paragraph*{d.}zul"assig\\
		Tupel (504, 05.02.2017, 10000, 401, 201) wird in die Tabelle $ darlehen $ eingef"ugt.\\ Daraufhin wird der Trigger \textbf{T1} ausgel"ost, der in der Tabelle $ bankkonto $ das Konto mit der b\_id 401 ver"andert: b\_guthaben "andert sich zu 20000.
		
		\paragraph*{e.}zul"assig\\
		Tupel (501, 03.02.2017, 5000, 401, 201) wird aus der Tabelle $ darlehen $ entfernt.
		
		\paragraph*{f.}zul"assig\\
		Tupel (201, Klein, 0, 26, NULL) wird aus der Tabelle $ kunde $ entfernt.\\
		Aufgrund des Constraints/Fremdschl"ussels \textbf{d\_kunde\_fk} werden alle Darlehen mit $ d\_kunde = 201 $ ebenfalls aus $ darlehen $ entfernt.
		
		\paragraph*{g.}nicht zul"assig\\
		Wegen Constraint $ b\_kontaktperson\_fk $ in Tabelle $ bankkonto $ (Mitarbeiter wird nicht gel"oscht, da er noch in mindestens einem Konto als Kontaktperson eingetragen ist).
		
		\paragraph*{h.}zul"assig\\
		Tupel (301, Groß, 35, 101) wird aus Tabelle $ mitarbeiter $ entfernt.
		
		\pagebreak
		
		
	\section*{Aufgabe 4.3}
		% Zeigen Sie mit Hilfe der Armstrong-Axiome, dass die abgeleiteten Regeln (union, decomposition, pseudotransitivity) ebenfalls gelten. Geben Sie für jeden Schritt an, welche Axiome Sie benutzt haben.
		\paragraph*{union}:\\
			$\alpha \rightarrow \beta$,	$\alpha \rightarrow \gamma$ \hspace*{25mm} (gegeben)\\
			0. $\alpha \rightarrow \alpha \alpha$ \hspace*{31mm} (gilt)\\
			1. $\alpha \alpha \rightarrow \alpha \beta$ \hspace*{29mm} (augmentation der ersten gegebenen)\\
			2. $\alpha \beta \rightarrow \alpha \gamma$ \hspace*{29mm} (augmentation der zweiten gegebenen)\\
			3. $\alpha \rightarrow \alpha \beta$ \hspace*{31mm} (transitivity von 0. und 1.)\\
			4. $\alpha \rightarrow \beta \gamma$ \hspace*{31mm} (transitivity von 1. und 2.)
			
		\paragraph*{decomposition}:\\
			1. $\alpha \rightarrow \beta \gamma$ \hspace*{31mm} (gegeben)\\
			2. $\beta \gamma \rightarrow \beta$ \hspace*{31mm} (reflexivity, $\beta \subseteq \beta\gamma$)\\
			3. $\alpha \rightarrow \beta$ \hspace*{33mm} (transitivity der oberen zwei Zeilen)\\
			analog für $\alpha \rightarrow \gamma$
		
		\paragraph*{pseudotransitivity}:\\
			$\alpha \rightarrow \beta, \beta\gamma \rightarrow \delta$ \hspace*{25mm} (gegeben)\\
			1. $ \alpha\gamma \rightarrow \beta\gamma $ \hspace*{30mm} (augmentation der ersten gegebenen mit $\gamma$)\\
			2. $\alpha \gamma \rightarrow \delta$ \hspace*{32mm} (transititvity der zweiten gegebenen und 1.)\\
			
			
		
		
	\section*{Aufgabe 4.4}
		\paragraph*{CLOSURE($\{ F \}, Z\backslash\{F \longrightarrow G\}$})\\
		result $=$ \{F\}\\
		
			\{F,C,D\} \hspace*{42mm} wegen $F \rightarrow CD$\\
			
			\{F,C,D,A\} \hspace*{39mm} wegen $D \rightarrow A$\\
			
			\{F,C,D,A,G,H\} \hspace*{32mm} wegen $AC \rightarrow GH$\\
			
			\hspace*{11mm}\textbf{\vdots}\\[1.2em]
			$G \in CLOSURE(\{F\}, Z \backslash \{F \longrightarrow G\})$\\
			$\Rightarrow F \rightarrow G$ ist redundante funktionale Abhängigkeit
	
		\paragraph*{CLOSURE($\{H\}, Z \backslash \{H \rightarrow B\}$})\\
		H steht auf keiner linken Seite der funktionalen Abh"angigkeiten in der Menge Z\\
		$\rightarrow B \notin CLOSURE(\{H\}, Z \backslash \{H \rightarrow B\})$\\ $\Rightarrow H \rightarrow B$ ist keine redundante funktionale Abhängigkeit
		
	
	
\end{document}